<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 WBC æ‡‰æ´ä¹‹æ—…</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Russo+One&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- Light Morandi x Baseball x iOS 26 Design System --- */
        :root {
            --radius-l: 32px; --radius-m: 20px; --radius-s: 12px;
            --font-stack: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            --font-sport: 'Russo One', sans-serif; 
            --font-ukiyo: 'Noto Serif JP', serif;
            
            /* Light Mode */
            --bg-base: #F5F5F0; --text-main: #444444; --text-sub: #666666; --text-muted: #999999;
            --m-blue: #7D8A93; --m-red: #B87878; --m-green: #9EAFA2; --m-tan: #D6C6B0;
            --m-grey: #A0A0A0; --m-gold: #C5A065;
            --glass-bg: rgba(255, 255, 255, 0.85); --glass-border: rgba(255, 255, 255, 0.9); --glass-blur: blur(35px);
            --shadow-soft: 0 10px 30px -5px rgba(125, 138, 147, 0.15), inset 0 1px 2px rgba(255, 255, 255, 0.9);
            
            /* Header Specific */
            --ukiyo-bg: #F4F1EA; --ukiyo-navy: #1D365D; --ukiyo-red: #C63D0F;     
            --gold-light: #F9E79F; --gold-main: #D4AC0D; --gold-dark: #9A7D0A;

            --table-bg: rgba(255,255,255,0.7); --table-row-hover: rgba(125, 138, 147, 0.05); --highlight-bg: rgba(184, 120, 120, 0.08);
            
            --input-bg: rgba(255, 255, 255, 0.6);
            --nav-bg: rgba(255, 255, 255, 0.25); --nav-blur: blur(50px); --nav-border: rgba(255, 255, 255, 0.3);
            --nav-active: #444444; --nav-inactive: #888888; 
            
            --status-ok: #4CAF50; --status-warn: #FFC107; --status-err: #F44336;
            --svg-fill: #FFFFFF; --svg-stroke: var(--m-blue);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-base: #121212; --text-main: #E0E0E0; --text-sub: #B0B0B0; --text-muted: #777777;
                --m-blue: #94A8B3; --m-red: #D18C8C; --m-green: #B3C7B7; --m-tan: #E0D0BA;
                --glass-bg: rgba(30, 30, 35, 0.75); --glass-border: rgba(255, 255, 255, 0.15);
                --shadow-soft: 0 10px 40px -5px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.1);
                
                --ukiyo-bg: #2B2B30; --ukiyo-navy: #4A6fa5; --ukiyo-red: #E57373;
                
                --table-bg: rgba(44, 44, 46, 0.6); --table-row-hover: rgba(255, 255, 255, 0.05); --highlight-bg: rgba(209, 140, 140, 0.15);
                --input-bg: rgba(60, 60, 65, 0.6);
                --nav-bg: rgba(30, 30, 35, 0.35); --nav-border: rgba(255, 255, 255, 0.1);
                --nav-active: #FFFFFF; --nav-inactive: #888888;
                --svg-fill: #2C2C2E; --svg-stroke: #94A8B3;
            }
        }

        body {
            font-family: var(--font-stack); margin: 0; padding: 0; color: var(--text-main); background-color: var(--bg-base);
            -webkit-font-smoothing: antialiased; padding-bottom: 120px; min-height: 100vh; overflow-x: hidden; width: 100%;
            transition: background-color 0.3s ease, color 0.3s ease;
            background-image: radial-gradient(circle at 10% 10%, rgba(125, 138, 147, 0.15), transparent 60%), radial-gradient(circle at 90% 20%, rgba(184, 120, 120, 0.1), transparent 50%), radial-gradient(circle at 50% 90%, rgba(158, 175, 162, 0.1), transparent 50%);
            background-attachment: fixed; background-size: cover; overscroll-behavior-x: none;
        }

        /* --- Header --- */
        .ukiyo-header {
            position: relative; background-color: var(--ukiyo-bg);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
            padding: 50px 24px 70px; overflow: hidden; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;
            margin-bottom: 20px; box-shadow: 0 15px 30px -10px rgba(0,0,0,0.2); text-align: center; border-bottom: 4px solid var(--ukiyo-navy);
        }
        .sun-ball { position: absolute; top: -20px; right: -20px; width: 180px; height: 180px; background: var(--ukiyo-red); border-radius: 50%; opacity: 0.15; z-index: 0; }
        .sun-ball::after { content: ''; position: absolute; width: 140px; height: 140px; border: 4px dashed var(--ukiyo-bg); border-radius: 50%; top: 20px; left: 20px; opacity: 0.5; }
        .wave-pattern { position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: radial-gradient(circle at 10px -7px, transparent 20px, var(--ukiyo-navy) 21px, var(--ukiyo-navy) 23px, transparent 24px) 0 0, radial-gradient(circle at 10px 27px, transparent 20px, var(--ukiyo-navy) 21px, var(--ukiyo-navy) 23px, transparent 24px) 50px 0; background-size: 100px 100px; opacity: 0.3; z-index: 0; }
        .header-content { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; }
        .gold-medal { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold-main) 50%, var(--gold-dark) 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2), inset 0 0 0 3px rgba(255,255,255,0.4); margin-bottom: 12px; color: #FFF; text-shadow: 0 1px 2px rgba(0,0,0,0.5); position: relative; }
        .gold-medal::before { content: ''; position: absolute; top: 5px; left: 5px; right: 5px; bottom: 5px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3); }
        .gm-text-main { font-family: var(--font-sport); font-size: 12px; line-height: 1; margin-bottom: 2px; }
        .gm-text-sub { font-family: var(--font-stack); font-size: 9px; font-weight: 900; letter-spacing: 1px; }
        .ukiyo-title { margin: 0; padding: 0; font-family: var(--font-ukiyo); font-size: 56px; line-height: 1; color: var(--ukiyo-navy); letter-spacing: 0px; text-shadow: 2px 2px 0px rgba(244, 241, 234, 0.8); position: relative; }
        .ukiyo-year { font-family: var(--font-sport); font-size: 20px; color: var(--m-gold); letter-spacing: 6px; margin-top: 5px; font-weight: 400; }
        .decor-line { width: 40px; height: 4px; background: var(--ukiyo-red); margin: 10px auto 0; border-radius: 2px; }

        /* --- Sync Status --- */
        .sync-container { position: absolute; top: 15px; left: 15px; z-index: 1000; display: flex; align-items: center; gap: 6px; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 4px 10px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        @media (prefers-color-scheme: dark) { .sync-container { background: rgba(30, 30, 35, 0.6); border: 1px solid rgba(255,255,255,0.1); } }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); transition: background 0.3s; }
        .sync-text { font-size: 10px; font-weight: 700; color: var(--text-sub); width: 85px; text-align: left; }
        .sync-dot.active { background: var(--status-ok); box-shadow: 0 0 5px var(--status-ok); }
        .sync-dot.working { background: var(--status-warn); animation: pulse-warn 1s infinite; }
        .sync-dot.error { background: var(--status-err); }
        @keyframes pulse-warn { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* --- Navigation --- */
        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 280px; background: var(--nav-bg); backdrop-filter: var(--nav-blur); -webkit-backdrop-filter: var(--nav-blur); border: 1px solid var(--nav-border); height: 50px; border-radius: 30px; display: flex; justify-content: space-evenly; align-items: center; z-index: 1000; box-shadow: 0 5px 25px rgba(0,0,0,0.15); }
        .nav-item { flex: 0 0 auto; width: 60px; text-align: center; cursor: pointer; color: var(--nav-inactive); font-size: 9px; font-weight: 700; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .nav-item.active { color: var(--nav-active); transform: translateY(-2px); text-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .nav-icon { font-size: 18px; display: block; margin-bottom: 0; }

        .sub-nav-wrapper { position: sticky; top: 10px; z-index: 900; margin: 0 20px 15px; display: none; }
        .sub-nav-wrapper.active { display: block; animation: fadeIn 0.3s ease; }
        .sub-tabs-container { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 50px; padding: 4px; display: flex; justify-content: flex-start; gap: 4px; overflow-x: auto; scrollbar-width: none; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .sub-tabs-container::-webkit-scrollbar { display: none; }
        .sub-tab-btn { flex: 0 0 auto; border: none; background: transparent; padding: 8px 16px; border-radius: 40px; font-family: var(--font-stack); font-size: 13px; color: var(--text-muted); cursor: pointer; transition: all 0.2s ease; text-align: center; font-weight: 600; min-width: 50px; }
        .sub-tab-btn.active { background: var(--text-main); color: var(--bg-base); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        /* --- Content Layout --- */
        .view-section { display: none; }
        .view-section.active { display: block; }
        .day-content { display: none; padding: 10px 20px 20px; }
        .day-content.active { display: block; }
        
        .slider-viewport { overflow: hidden; width: 100%; position: relative; }
        .slider-track { display: flex; width: 100%; align-items: flex-start; will-change: transform, height; transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1), height 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .slider-track > .day-content { display: block !important; min-width: 100%; opacity: 1; padding: 10px 20px 20px; box-sizing: border-box; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .anim-up { animation: slideUp 0.4s ease-out; }

        /* --- Components --- */
        .flight-widget { margin: 0 20px 15px; padding: 20px; background: var(--glass-bg); backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); border-radius: 24px; box-shadow: var(--shadow-soft); display: flex; justify-content: space-between; align-items: center; position: relative; }
        .flight-widget::before { content: ''; position: absolute; top: 8px; bottom: 8px; left: 8px; right: 8px; border: 1px dashed rgba(125, 138, 147, 0.3); border-radius: 20px; pointer-events: none; }
        .flight-label { font-size: 11px; color: var(--text-muted); margin-bottom: 2px; font-weight: 600; }
        .flight-val { font-family: var(--font-serif); font-size: 20px; font-weight: 800; color: var(--text-main); }
        .flight-icon { font-size: 18px; color: var(--m-blue); transform: rotate(45deg); opacity: 0.8; }
        .term-tag { font-size: 10px; background: var(--m-red); color: #fff; padding: 1px 5px; border-radius: 4px; margin-left: 4px; font-family: var(--font-stack); vertical-align: middle; }

        .timeline-item { display: flex; margin-bottom: 30px; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: 24px; top: 18px; bottom: -35px; width: 2px; background: linear-gradient(to bottom, var(--m-blue) 0%, rgba(0,0,0,0) 100%); z-index: 0; opacity: 0.3; }
        .timeline-item:last-child::before { display: none; }
        .time-col { min-width: 50px; padding-top: 2px; z-index: 1; display: flex; flex-direction: column; align-items: center; }
        .diamond-dot { width: 12px; height: 12px; background: var(--bg-base); border: 3px solid var(--m-blue); transform: rotate(45deg); margin-bottom: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .time-text { font-size: 15px; font-weight: 700; color: var(--m-blue); background: var(--glass-bg); padding: 2px 5px; border-radius: 6px; }

        .card { flex: 1; margin-left: 15px; padding: 22px; background: var(--glass-bg); backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur); border: 1px solid var(--glass-border); border-radius: var(--radius-m); box-shadow: var(--shadow-soft); position: relative; overflow: hidden; transition: transform 0.2s; }
        .card-title { font-family: var(--font-stack); font-size: 18px; font-weight: 800; margin-bottom: 10px; color: var(--text-main); border-bottom: 1px solid var(--glass-border); padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .info-grid { display: grid; gap: 10px; }
        .info-row { font-size: 14px; line-height: 1.6; color: var(--text-sub); display: flex; align-items: baseline; font-weight: 500; }
        .info-text { flex: 1; word-wrap: break-word; overflow-wrap: break-word; }
        .badge { flex-shrink: 0; font-size: 11px; font-weight: 700; color: #FFF; padding: 3px 8px; border-radius: 6px; margin-right: 10px; min-width: 28px; text-align: center; letter-spacing: 0.5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .badge.eat { background: var(--m-red); } .badge.play { background: var(--m-green); } .badge.shop { background: var(--m-tan); color: #444; } .badge.wear { background: var(--m-blue); } .badge.move { background: var(--m-grey); color: #FFF; } .badge.stay { background: #8C8C8C; }

        .card.game-card { background: linear-gradient(135deg, var(--glass-bg), rgba(125, 138, 147, 0.1)); border-left: 4px solid var(--m-blue); }
        .game-header { font-size: 11px; color: var(--m-blue); letter-spacing: 1px; font-weight: 700; margin-bottom: 4px; text-transform: uppercase; }
        .game-title { font-size: 22px; font-weight: 800; color: var(--text-main); margin-bottom: 10px; }
        .analysis-box { background: var(--highlight-bg); border-radius: 8px; padding: 10px 12px; margin-bottom: 12px; border: 1px solid rgba(184, 120, 120, 0.2); }
        .analysis-title { font-size: 11px; color: var(--m-red); font-weight: 800; text-transform: uppercase; display: block; margin-bottom: 4px; letter-spacing: 1px; }
        .analysis-text { font-size: 13px; color: var(--text-sub); line-height: 1.6; text-align: justify; font-weight: 400; }
        .analysis-box ol { padding-left: 18px; margin: 4px 0; }
        .analysis-box li { margin-bottom: 3px; font-size: 13px; color: var(--text-sub); }

        .nav-btn { display: flex; align-items: center; justify-content: center; gap: 6px; width: 100%; box-sizing: border-box; background: rgba(125, 138, 147, 0.15); color: var(--m-blue); font-weight: 700; font-size: 14px; padding: 10px; border-radius: 12px; text-decoration: none; margin-top: 12px; border: 1px solid var(--glass-border); transition: all 0.2s; }
        .nav-btn:active { background: rgba(125, 138, 147, 0.3); }

        /* Tools */
        .calc-container { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
        .calc-row { display: flex; flex-direction: column; gap: 5px; }
        .calc-label { font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .calc-input-wrapper { position: relative; }
        .calc-input { width: 100%; box-sizing: border-box; background: var(--input-bg); border: 2px solid transparent; border-radius: 16px; padding: 15px 15px 15px 50px; font-size: 28px; font-weight: 700; color: var(--text-main); font-family: var(--font-serif); outline: none; transition: all 0.3s; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); }
        .calc-input:focus { border-color: var(--m-blue); background: var(--glass-bg); }
        .currency-flag { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 24px; }
        .rate-display { text-align: center; font-size: 13px; color: var(--text-sub); margin-top: 5px; font-weight: 500; }
        .rate-display span { color: var(--m-red); font-weight: 700; }
        .rate-source { text-align: center; font-size: 11px; color: var(--text-muted); margin-top: 2px; }
        
        .add-btn, .reset-btn { position: relative; top: -2px; font-size: 12px; color: #FFF; background: var(--m-red); border: none; cursor: pointer; padding: 4px 14px; font-weight: 700; border-radius: 15px; box-shadow: 0 2px 5px rgba(184,120,120,0.4); transition: transform 0.1s; }
        .add-btn:active, .reset-btn:active { transform: scale(0.95); }
        .reset-btn { position: absolute; right: 0; top: -2px; padding: 6px 16px; border-radius: 20px; box-shadow: 0 3px 8px rgba(184,120,120,0.5); letter-spacing: 1px; }

        /* Packing Table (New Style) */
        .packing-table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        .packing-table th { color: var(--text-muted); font-size: 11px; text-align: left; padding: 5px; border-bottom: 2px solid rgba(125,138,147,0.2); font-weight: 700; }
        .packing-table td { padding: 8px 5px; border-bottom: 1px solid rgba(125,138,147,0.1); vertical-align: middle; }
        .packing-check { width: 22px; height: 22px; accent-color: var(--m-blue); cursor: pointer; }
        .packing-input { width: 100%; border: none; background: transparent; font-family: var(--font-stack); font-size: 15px; color: var(--text-main); outline: none; padding: 4px 0; }
        .packing-input.checked { text-decoration: line-through; opacity: 0.5; }
        .qty-input { width: 35px; text-align: center; border: none; background: transparent; font-family: var(--font-stack); font-size: 15px; color: var(--text-main); border-bottom: 1px dashed var(--hr-color); }
        .packing-del { color: var(--text-muted); background: none; border: none; font-size: 20px; padding: 0 5px; cursor: pointer; opacity: 0.5; }
        .packing-del:hover { color: var(--m-red); opacity: 1; }
        
        /* New Categorized Shopping List Styles */
        .shop-category { margin-bottom: 20px; border-radius: 12px; background: rgba(255,255,255,0.4); overflow: hidden; border: 1px solid rgba(125, 138, 147, 0.2); }
        .shop-cat-header { background: rgba(125, 138, 147, 0.15); padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; }
        .shop-cat-title { font-weight: 800; color: var(--m-blue); font-size: 14px; border: none; background: transparent; outline: none; width: 70%; font-family: var(--font-stack); }
        .shop-cat-actions { display: flex; gap: 5px; }
        .shop-item-btn { font-size: 11px; background: var(--m-green); color: white; border: none; border-radius: 10px; padding: 2px 8px; cursor: pointer; }
        .shop-cat-del { font-size: 16px; color: var(--text-muted); cursor: pointer; background: none; border: none; }
        .shop-items-container { padding: 5px 10px 10px; }
        .shop-input-new { flex: 1; padding: 8px; border: 1px solid var(--glass-border); border-radius: 8px; background: var(--input-bg); color: var(--text-main); font-family: var(--font-stack); font-size: 14px; outline: none; }
        .shop-controls { display: flex; gap: 5px; margin-bottom: 10px; }
        
        /* Expense Styles */
        .expense-date-block { margin-bottom: 20px; background: var(--glass-bg); border-radius: 16px; border: 1px solid var(--glass-border); overflow: hidden; }
        .expense-header { background: rgba(125, 138, 147, 0.15); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; }
        .expense-date-input { border: none; background: transparent; font-weight: 800; color: var(--m-blue); font-size: 15px; font-family: var(--font-stack); outline: none; width: 40%; }
        .expense-summary { font-size: 12px; font-weight: 700; color: var(--text-sub); background: rgba(255,255,255,0.5); padding: 2px 8px; border-radius: 10px; }
        .expense-body { padding: 10px; }
        .expense-row { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; }
        .expense-item-input { flex: 2; padding: 6px; border: 1px solid var(--glass-border); border-radius: 6px; background: var(--input-bg); color: var(--text-main); font-size: 13px; width: 100%; outline: none; }
        /* Hide Spinners for Number Input */
        .expense-price-input { 
            flex: 1; padding: 6px; border: 1px solid var(--glass-border); border-radius: 6px; 
            background: var(--input-bg); color: var(--text-main); font-size: 13px; width: 100%; 
            outline: none; text-align: right; 
            -moz-appearance: textfield; 
        }
        .expense-price-input::-webkit-outer-spin-button,
        .expense-price-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .expense-currency { width: 55px; padding: 6px 2px; border: 1px solid var(--glass-border); border-radius: 6px; background: var(--input-bg); color: var(--text-main); font-size: 11px; outline: none; text-align: center; }
        .expense-add-row { text-align: center; margin-top: 5px; }
        .expense-item-btn { font-size: 11px; background: var(--m-tan); color: #444; border: none; border-radius: 10px; padding: 4px 12px; cursor: pointer; font-weight: 700; }
        
        /* Grand Total Style */
        .expense-grand-total { font-size: 13px; color: var(--m-blue); font-weight: 700; margin-left: auto; margin-right: 10px; }

        /* WBC Table */
        .wbc-table-container { border-radius: var(--radius-m); box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .wbc-table { width: 100%; border-collapse: collapse; font-size: 14px; background: var(--table-bg); table-layout: fixed; }
        .wbc-table th:first-child, .wbc-table td:first-child { width: 45px; background: var(--m-blue); color: white; font-weight: 700; padding: 12px 5px; text-align: center; white-space: nowrap; }
        .wbc-table td:first-child { background: transparent; color: var(--text-main); }
        .wbc-table th:nth-child(2), .wbc-table td:nth-child(2) { padding: 14px 12px; text-align: left; white-space: normal; word-wrap: break-word; }
        .wbc-table th:nth-child(2) { background: var(--m-blue); color: white; }
        .wbc-table th:nth-child(3), .wbc-table td:nth-child(3) { width: 50px; padding: 12px 5px; text-align: center; white-space: nowrap; }
        .wbc-table th:nth-child(3) { background: var(--m-blue); color: white; }
        .wbc-table tr:last-child td { border-bottom: none; }
        .wbc-table tr:nth-child(even) { background-color: var(--table-row-hover); }
        .tpe-highlight { background-color: var(--highlight-bg) !important; }
        .point-text { display: block; margin-top: 6px; font-size: 13px; color: var(--m-red); font-weight: 500; line-height: 1.5; }
        .team-name { font-weight: 800; font-size: 18px; color: var(--text-main); display: block; line-height: 1.4; margin-bottom: 2px; }
        .pool-teams { display: block; margin-top: 4px; font-size: 13px; font-weight: 500; color: var(--text-sub); line-height: 1.5; }
    </style>
</head>
<body>

    <div class="sync-container">
        <div class="sync-dot" id="sync-dot"></div>
        <span class="sync-text" id="sync-text">é€£ç·šä¸­...</span>
    </div>

    <header class="ukiyo-header">
        <div class="sun-ball"></div>
        <div class="wave-pattern"></div>
        <div class="header-content">
            <div class="gold-medal">
                <span class="gm-text-main">TEAM</span>
                <span class="gm-text-sub">TAIWAN</span>
            </div>
            <h1 class="ukiyo-title">TOKYO</h1>
            <div class="ukiyo-year">WBC 2026</div>
            <div class="decor-line"></div>
        </div>
    </header>

    <div id="sub-nav-itinerary" class="sub-nav-wrapper active">
        <div class="sub-tabs-container">
            <button class="sub-tab-btn active" data-tab="d1" onclick="showSubTab('d1', this)">3/5 (å››)</button>
            <button class="sub-tab-btn" data-tab="d2" onclick="showSubTab('d2', this)">3/6 (äº”)</button>
            <button class="sub-tab-btn" data-tab="d3" onclick="showSubTab('d3', this)">3/7 (å…­)</button>
            <button class="sub-tab-btn" data-tab="d4" onclick="showSubTab('d4', this)">3/8 (æ—¥)</button>
            <button class="sub-tab-btn" data-tab="d5" onclick="showSubTab('d5', this)">3/9 (ä¸€)</button>
        </div>
    </div>

    <div id="sub-nav-tools" class="sub-nav-wrapper">
        <div class="sub-tabs-container" style="justify-content: center;">
            <button class="sub-tab-btn active" onclick="showSubTab('shop', this)">å¿…è²·æ¸…å–®</button>
            <button class="sub-tab-btn" onclick="showSubTab('expenses', this)">è¨˜å¸³</button>
            <button class="sub-tab-btn" onclick="showSubTab('packing', this)">è¡Œææ¸…å–®</button>
            <button class="sub-tab-btn" onclick="showSubTab('calc', this)">åŒ¯ç‡æ›ç®—</button>
        </div>
    </div>

    <div id="view-itinerary" class="view-section active">
        <div class="flight-widget">
            <div>
                <div class="flight-label">å»ç¨‹ (3/5)</div>
                <div class="flight-val">BR190 <span class="term-tag">T1</span></div>
                <div style="color:var(--text-muted); font-size:13px; font-weight:500;">16:30 TSA</div>
            </div>
            <div class="flight-icon">âœˆ</div>
            <div style="text-align:right;">
                <div class="flight-label">å›ç¨‹ (3/9)</div>
                <div class="flight-val">BR189 <span class="term-tag">T3</span></div>
                <div style="color:var(--text-muted); font-size:13px; font-weight:500;">10:25 HND</div>
            </div>
        </div>

        <div class="slider-viewport" id="itinerary-slider-view">
            <div class="slider-track" id="itinerary-track">
                
                <div id="d1" class="day-content">
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">20:20</div></div>
                        <div class="card">
                            <div class="card-title">ç¾½ç”°æ©Ÿå ´ (HND)</div>
                            <div class="analysis-box">
                                <span class="analysis-title">ğŸ‡¯ğŸ‡µ å…¥å¢ƒé€šé—œæŒ‡å—</span>
                                <ol>
                                    <li><strong>æª¢ç–«</strong>ï¼šä¾æŒ‡ç¤ºå‰é€²ã€‚</li>
                                    <li><strong>å…¥åœ‹å¯©æŸ¥</strong>ï¼šå‡ºç¤ºè­·ç…§èˆ‡ VJW QR Codeã€‚</li>
                                    <li><strong>æå–è¡Œæ</strong>ï¼šç¢ºèªèˆªç­è¡Œæè½‰ç›¤ã€‚</li>
                                    <li><strong>ç¨…é—œç”³å ±</strong>ï¼šæƒæ VJW ç”³å ± QR Codeã€‚</li>
                                </ol>
                            </div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge move">è¡Œ</span>å‡ºé—œå¾Œä¾æŒ‡æ¨™æ­ä¹˜ã€Œäº¬æ€¥ç·šã€å¾€æ©«æ¿±ã€‚</div>
                            </div>
                            <div class="action-row">
                                <a href="https://vjw-lp.digital.go.jp/en/" target="_blank" class="nav-btn">ğŸ”— Visit Japan Web</a>
                                <a href="https://www.google.com/maps/search/?api=1&query=Tokyo+Tower5" target="_blank" class="nav-btn">ğŸ“ é–‹å§‹å°èˆª</a>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">22:00</div></div>
                        <div class="card">
                            <div class="card-title">æ©«æ¿±é—œå…§ (Base)</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge stay">ä½</span>æŠµé”æœ‹å‹å®¶å®‰ç½®è¡Œæã€‚</div>
                                <div class="info-row"><span class="badge eat">é£Ÿ</span>å®µå¤œï¼šä¼Šå‹¢ä½æœ¨ç”ºã€Œä¸€è˜­ã€æˆ–ã€Œä¸‰ç”°è£½éºµæ‰€ã€ã€‚</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="d2" class="day-content">
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">10:00</div></div>
                        <div class="card">
                            <div class="card-title">æ©«é ˆè³€è»æ¸¯ä¹‹æ—…</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge move">è¡Œ</span>æ­ä¹˜äº¬æ€¥ç·šè‡³ã€Œæ©«é ˆè³€ä¸­å¤®ç«™ã€æˆ– JR è‡³ã€Œæ©«é ˆè³€ç«™ã€ã€‚</div>
                                <div class="info-row"><span class="badge play">æ¨‚</span>ä¸‰ç¬ å…¬åœ’åƒè§€ä¸–ç•Œä¸‰å¤§ç´€å¿µè‰¦ã€Œä¸‰ç¬ è™Ÿã€ã€‚</div>
                            </div>
                            <a href="https://www.google.com/maps?q=Mikasa+Park" target="_blank" class="nav-btn">ğŸ“ å°èˆªä¸‰ç¬ å…¬åœ’</a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">13:00</div></div>
                        <div class="card">
                            <div class="card-title">æµ·è»å’–å“© & æºæ¿é€š</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge eat">é£Ÿ</span>å“åšé“åœ°ã€Œæ©«é ˆè³€æµ·è»å’–å“©ã€æˆ–ã€Œæµ·è»æ¼¢å ¡ã€ã€‚</div>
                                <div class="info-row"><span class="badge play">æ¨‚</span>æ¼«æ­¥ Dobuita Streetï¼Œæ„Ÿå—æ¿ƒåšç¾å¼é¢¨æƒ…ï¼Œé¸è³¼ Sukajan åˆºç¹¡å¤–å¥—ã€‚</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">16:00</div></div>
                        <div class="card">
                            <div class="card-title">æ©«æ¿±ç«™å‰å¤§æ¡è³¼</div>
                            <div class="info-grid">
                                <div class="info-row">
                                    <span class="badge shop">è²·</span>
                                    <span class="info-text"><strong>Bic Camera</strong>ï¼šæ©«æ¿±ç«™è¥¿å£åº—ï¼Œæ¡è³¼é›»å™¨ 3Cã€‚</span>
                                </div>
                                <div class="info-row">
                                    <span class="badge shop">è²·</span>
                                    <span class="info-text"><strong>ç„¡å°è‰¯å“</strong>ï¼šç›¸éµ JOINUS æˆ– NEWoMan æ©«æ¿±åº—ã€‚</span>
                                </div>
                                <div class="info-row">
                                    <span class="badge shop">è²·</span>
                                    <span class="info-text"><strong>è—¥å¦åº—</strong>ï¼šæ¾æœ¬æ¸…ã€SunDrug è£œè²¨ã€‚</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">18:30</div></div>
                        <div class="card">
                            <div class="card-title">è¿”å›ä½æ‰€ (å‚™æˆ°)</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge move">è¡Œ</span>å¸¶è‘—æˆ°åˆ©å“è¿”å›æ©«æ¿±é—œå…§ä½æ‰€ã€‚</div>
                                <div class="info-row"><span class="badge eat">é£Ÿ</span>æ²¿é€”æ¡è²·æ™šé¤èˆ‡æ‡‰æ´é…’æ°´ã€‚</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot" style="background:var(--m-red); border-color:var(--m-red);"></div><div class="time-text" style="color:var(--m-red);">19:00</div></div>
                        <div class="card game-card">
                            <div class="game-header">Pool C â€¢ Game 1 (Online Streaming)</div>
                            <div class="card-title" style="color:var(--text-main);">ğŸ‡¹ğŸ‡¼ TPE vs ğŸ‡¯ğŸ‡µ JPN</div>
                            <div class="analysis-box">
                                <span class="analysis-title">ğŸ“º ä½æ‰€ç·šä¸Šæ‡‰æ´</span>
                                <span class="analysis-text">é›–ç„¶æœªé€²å ´ï¼Œä½†åœ¨ä½æ‰€èˆ’é©åœ°è§€çœ‹ç›´æ’­ï¼Œä¸ç”¨äººæ“ äººï¼Œæ›´èƒ½å°ˆæ³¨æ–¼æ¯ä¸€å€‹ç²¾å½©å¥½çƒï¼</span>
                            </div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge wear">è¡£</span>æ›ä¸Šèˆ’é©å±…å®¶æœï¼ŒæŠ«ä¸Šä¸­è¯éšŠæ¯›å·¾ï¼</div>
                                <div class="info-row"><span class="badge eat">é£Ÿ</span>äº«ç”¨å‰›è²·å¥½çš„è±ç››æ™šé¤èˆ‡é£²æ–™ã€‚</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="d3" class="day-content">
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">10:00</div></div>
                        <div class="card">
                            <div class="card-title">æ—©æ™¨ç§»å‹•</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge move">è¡Œ</span>åˆå ´æ¯”è³½éœ€æ—©èµ·ã€‚å»ºè­° 10:00 å‰æŠµé”æ°´é“æ©‹ã€‚</div>
                                <div class="info-row"><span class="badge eat">é£Ÿ</span>æ—©é¤ï¼šä¾¿åˆ©å•†åº—é£¯ç³°ã€‚</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot" style="background:var(--m-red); border-color:var(--m-red);"></div><div class="time-text" style="color:var(--m-red);">12:00</div></div>
                        <div class="card game-card">
                            <div class="game-header">Pool C â€¢ Game 2</div>
                            <div class="card-title" style="color:var(--text-main);">ğŸ‡¨ğŸ‡¿ CZE vs ğŸ‡¹ğŸ‡¼ TPE</div>
                            <div class="analysis-box">
                                <span class="analysis-title">âš¾ æˆ°æƒ…çŸ­è©•</span>
                                <span class="analysis-text">æ–œæ§“é¬¥å£« vs è·æ¥­èè‹±ã€‚æ·å…‹éšŠä»¥ã€Œå¹³æ—¥ä¸Šç­ã€å‡æ—¥æ‰“çƒã€çš„ç†±è¡€æ•…äº‹èåï¼Œçƒé¢¨ç©©å¥ä¸”é¬¥å¿—é«˜æ˜‚ã€‚ä¸­è¯éšŠéœ€ç©©ç´®ç©©æ‰“ï¼Œé¿å…è¢«çˆ†å†·ï¼Œé€™æ˜¯æ¶ä¸‹æ™‰ç´šé–€ç¥¨çš„å¿…å‹ä¹‹æˆ°ã€‚</span>
                            </div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge wear">è¡£</span>å·¨è›‹å…§æœ‰ç©ºèª¿ï¼Œå»ºè­°æ´‹è”¥å¼ç©¿æ­ã€‚</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">17:00</div></div>
                        <div class="card">
                            <div class="card-title">æ±äº¬éµå¡”</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge play">æ¨‚</span>è³½å¾Œå‰å¾€èŠå…¬åœ’æˆ–èµ¤ç¾½æ©‹ï¼Œæ‹æ”ç¶“å…¸ç´…ç™½éµå¡”èˆ‡é»ƒæ˜ç¾æ™¯ã€‚æ™šé¤å¯æ–¼é™„è¿‘çš„éº»å¸ƒå°ä¹‹ä¸˜æˆ–æ–°æ©‹äº«ç”¨ã€‚</div>
                            </div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Ginza+Uniqlo+Tokyo" target="_blank" class="nav-btn">ğŸ“ å°èˆª</a>
                        </div>
                    </div>
                </div>

                <div id="d4" class="day-content">
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">08:30</div></div>
                        <div class="card">
                            <div class="card-title">æ·ºè‰å¯ºåƒæ‹œ</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge play">æ¨‚</span>æ—©èµ·å‰å¾€æ·ºè‰é›·é–€ï¼Œé¿é–‹äººæ½®ï¼Œåƒæ‹œè§€éŸ³ç¥ˆæ±‚ä¸­è¯éšŠå¿…å‹ã€‚</div>
                                <div class="info-row"><span class="badge move">è¡Œ</span>åƒæ‹œå¾Œæ­ä¹˜éŠ€åº§ç·š/ä¸¸ä¹‹å…§ç·šå‰å¾€æ±äº¬å·¨è›‹ã€‚</div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot" style="background:var(--m-red); border-color:var(--m-red);"></div><div class="time-text" style="color:var(--m-red);">12:00</div></div>
                        <div class="card game-card">
                            <div class="game-header">Pool C â€¢ Game 3</div>
                            <div class="card-title" style="color:var(--text-main);">ğŸ‡°ğŸ‡· KOR vs ğŸ‡¹ğŸ‡¼ TPE</div>
                            <div class="analysis-box">
                                <span class="analysis-title">âš¾ æˆ°æƒ…çŸ­è©•</span>
                                <span class="analysis-text">å®¿å‘½å°æ±ºï¼æ”¸é—œåˆ†çµ„æ™‰ç´šçš„æœ€é—œéµæˆ°å½¹ã€‚æ°£æ°›å°‡æ¯”æ—¥éŸ“æˆ°æ›´ç‚ºç·Šç¹ƒï¼Œè«‹æº–å‚™å¥½æœ€å¼·ç«åŠ›ï¼</span>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">18:00</div></div>
                        <div class="card">
                            <div class="card-title">ALEGRIA æ…¶åŠŸå®´</div>
                            <div class="info-grid">
                                <div class="info-row">
                                    <span class="badge eat">é£Ÿ</span>
                                    <span class="info-text">è³½å¾Œç§»å‹•å›æ©«æ¿±ï¼Œæ–¼ <strong>ALEGRIA Minatomirai</strong> äº«ç”¨ 20 ç¨®å·´è¥¿çƒ¤è‚‰åƒåˆ°é£½èˆ‡å•¤é…’ï¼Œå¤§å£åƒè‚‰æ…¶ç¥å‹åˆ©ï¼</span>
                                </div>
                                <div class="info-row"><span class="badge play">æ¨‚</span>é¤å¾Œæ¼«æ­¥æ¸¯æœªä¾†ï¼Œæ¬£è³æ‘©å¤©è¼ªå¤œæ™¯ã€‚</div>
                            </div>
                            <a href="https://maps.app.goo.gl/YourMapLinkHere" target="_blank" class="nav-btn">ğŸ“ å°èˆª ALEGRIA</a>
                        </div>
                    </div>
                </div>

                <div id="d5" class="day-content">
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">07:00</div></div>
                        <div class="card">
                            <div class="card-title">å‰å¾€ç¾½ç”°æ©Ÿå ´</div>
                            <div class="analysis-box">
                                <span class="analysis-title">âœˆï¸ å‡ºå¢ƒé›¢æ—¥æµç¨‹</span>
                                <ol>
                                    <li><strong>å ±åˆ°</strong>: 3F å‡ºç™¼å¤§å»³ã€‚</li>
                                    <li><strong>å®‰æª¢</strong>: å–å‡ºç­†é›»æ¶²é«”ã€‚</li>
                                    <li><strong>å‡ºå¢ƒ</strong>: ä½¿ç”¨ Face Express æˆ–äººå·¥ã€‚</li>
                                </ol>
                            </div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge move">è¡Œ</span>ä¸Šç­æ—¥é›»è»Šæ“æ“ ï¼Œå‹™å¿… 07:00 å‡ºç™¼ã€‚</div>
                                <div class="info-row"><span class="badge stay">ä½</span>æ•´ç†è¡Œæï¼Œæ„Ÿè¬æœ‹å‹æ‹›å¾…ã€‚</div>
                            </div>
                            <a href="https://www.keikyu.co.jp/" target="_blank" class="nav-btn">ğŸ“ æ™‚åˆ»è¡¨ (æ—¥æ–‡å®˜ç¶²)</a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="time-col"><div class="diamond-dot"></div><div class="time-text">10:25</div></div>
                        <div class="card">
                            <div class="card-title">BR189 è¿”å°</div>
                            <div class="info-grid">
                                <div class="info-row"><span class="badge shop">è²·</span>æœ€å¾Œè¡åˆºï¼šæ©Ÿå ´å…ç¨…åº—ã€‚</div>
                                <div class="info-row"><span class="badge move">å®¶</span>é è¨ˆ 13:25 æŠµé”å°åŒ—æ¾å±±ã€‚</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> </div> </div>

    <div id="view-tools" class="view-section">
        
        <div id="shop" class="day-content active">
            <div class="card" style="margin-left:0;">
                <div class="card-title" style="position:relative;">
                    å¿…è²·æ¸…å–® ğŸ›ï¸
                    <button class="add-btn" onclick="addCategory()">+ æ–°å¢é¡åˆ¥</button>
                </div>
                <div id="shopping-container" style="margin-top:15px;">
                    </div>
            </div>
        </div>

        <div id="expenses" class="day-content">
            <div class="card" style="margin-left:0;">
                <div class="card-title" style="position:relative;">
                    è¨˜å¸³æœ¬ ğŸ’°
                    <span id="expense-grand-total" class="expense-grand-total">Total: Â¥0 | $0</span>
                </div>
                <div id="expense-container" style="margin-top:15px;">
                    </div>
            </div>
        </div>

        <div id="packing" class="day-content">
            <div class="card" style="margin-left:0;">
                <div class="card-title" style="position:relative;">
                    è¡Œææ¸…å–® ğŸ§³
                    <button class="add-btn" onclick="addPackingItem()">+ æ–°å¢</button>
                </div>
                <div style="margin-top:10px;">
                    <table class="packing-table">
                        <thead>
                            <tr style="color:var(--text-muted); font-size:11px; border-bottom:2px solid rgba(125,138,147,0.2);">
                                <th style="width:30px; text-align:center;">âœ“</th>
                                <th style="text-align:left; padding-left:5px;">é …ç›®</th>
                                <th style="width:40px; text-align:center;">æ•¸é‡</th>
                                <th style="width:30px;"></th>
                            </tr>
                        </thead>
                        <tbody id="packing-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="calc" class="day-content">
            <div class="card" style="margin-left:0;">
                <div class="card-title" style="position:relative;">
                    åŒ¯ç‡æ›ç®— ğŸ’±
                    <button class="reset-btn" onclick="resetCalc()">â†º é‡è¨­</button>
                </div>
                <div class="analysis-box" style="margin-bottom:20px;">
                    <span class="analysis-text">ä»¥<strong>å°ç£å¸‚å ´</strong>åŒ¯ç‡æ›ç®— (éœ€é€£ç¶²)</span>
                </div>
                <div class="calc-container">
                    <div class="calc-row">
                        <span class="calc-label">JPY æ—¥å¹£</span>
                        <div class="calc-input-wrapper">
                            <span class="currency-flag">ğŸ‡¯ğŸ‡µ</span>
                            <input type="number" id="input-jpy" class="calc-input" placeholder="0">
                        </div>
                    </div>
                    <div style="text-align:center; color:var(--m-blue); font-size:20px;">â‡…</div>
                    <div class="calc-row">
                        <span class="calc-label">TWD å°å¹£</span>
                        <div class="calc-input-wrapper">
                            <span class="currency-flag">ğŸ‡¹ğŸ‡¼</span>
                            <input type="number" id="input-twd" class="calc-input" placeholder="0">
                        </div>
                    </div>
                    <div class="rate-display">ç›®å‰åŒ¯ç‡: 1 JPY â‰ˆ <span id="rate-val">0.215</span> TWD</div>
                    <div id="rate-source" class="rate-source">è³‡æ–™ä¾†æº: è¼‰å…¥ä¸­...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-wbc" class="view-section">
        <div class="day-content active" style="padding-top:10px;">
            <div class="card" style="margin-left:0; margin-top:20px;">
                <div class="card-title">
                    Pool C (Tokyo)
                    <span class="pool-teams">ğŸ‡¹ğŸ‡¼ å°ç£ãƒ»ğŸ‡¯ğŸ‡µ æ—¥æœ¬ãƒ»ğŸ‡°ğŸ‡· éŸ“åœ‹ãƒ»ğŸ‡¦ğŸ‡º æ¾³æ´²ãƒ»ğŸ‡¨ğŸ‡¿ æ·å…‹</span>
                </div>
                <div class="wbc-table-container">
                    <table class="wbc-table">
                        <thead>
                            <tr><th>Date</th><th>Matchup & Key Point</th><th>Time</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>3/5</td><td><span class="team-name">ğŸ‡¦ğŸ‡º AUS vs ğŸ‡¹ğŸ‡¼ TPE</span><span class="point-text">é¦–æˆ°å³æ±ºæˆ°ï¼æ¾³æ´²è¿‘å¹´é•·æ‰“å¯¦åŠ›å¤§å¢ï¼Œä¸”æ“æœ‰å¤šä½ç¾è·é«”ç³»æ–°ç§€ã€‚ä¸­è¯éšŠéœ€é éˆæ´»èª¿åº¦èˆ‡æˆ°è¡“æ¶ä¸‹é–‹é–€ç´…ã€‚</span></td><td>12:00</td></tr>
                            <tr><td>3/5</td><td><span class="team-name">ğŸ‡°ğŸ‡· KOR vs ğŸ‡¨ğŸ‡¿ CZE</span><span class="point-text">éŸ“åœ‹éšŠä¸Šå±†çˆ†å†·å‡ºå±€çš„é™°å½±çŒ¶åœ¨ï¼Œæ­¤æˆ°å‹¢å¿…ç²¾éŠ³ç›¡å‡ºä»¥æ±‚ç©©ä½é™£è…³ã€‚</span></td><td>19:00</td></tr>
                            <tr><td>3/6</td><td><span class="team-name">ğŸ‡¨ğŸ‡¿ CZE vs ğŸ‡¦ğŸ‡º AUS</span><span class="point-text">æ­æ´²èˆ‡å¤§æ´‹æ´²çš„çƒé¢¨ç¢°æ’ã€‚æ·å…‹éšŠçš„åœ˜éšŠé»˜å¥‘æ¥µä½³ï¼Œå°æŠ—æ¾³æ´²éšŠçš„ç¾å¼å¼·åŠ›æ£’çƒã€‚</span></td><td>12:00</td></tr>
                            <tr class="tpe-highlight"><td>3/6</td><td><span class="team-name" style="color:var(--m-blue);">ğŸ‡¹ğŸ‡¼ TPE vs ğŸ‡¯ğŸ‡µ JPN</span><span class="point-text">è¬çœ¾çŸšç›®ï¼å°ç£é»ƒé‡‘æ‰“ç·šæŒ‘æˆ°æ—¥æœ¬ã€Œä¾Japanã€å…¨æ˜æ˜Ÿé™£å®¹ã€‚ç„¡è«–å‹è² éƒ½æ˜¯æœ€é›£å¿˜çš„æ™‚åˆ»ã€‚</span></td><td>19:00</td></tr>
                            <tr class="tpe-highlight"><td>3/7</td><td><span class="team-name" style="color:var(--m-blue);">ğŸ‡¨ğŸ‡¿ CZE vs ğŸ‡¹ğŸ‡¼ TPE</span><span class="point-text">çµ•å°ä¸èƒ½è¼•æ•µï¼æ·å…‹æŠ•æ‰‹çš„çƒé€Ÿé›–ä¸å¿«ï¼Œä½†æ€ªç•°çš„å‡ºæ‰‹é»å®¹æ˜“è®“æ‰“è€…ç†„ç«ã€‚é€™æ˜¯ç´¯ç©æ·¨å‹åˆ†çš„é—œéµæˆ°ã€‚</span></td><td>12:00</td></tr>
                            <tr><td>3/7</td><td><span class="team-name">ğŸ‡°ğŸ‡· KOR vs ğŸ‡¯ğŸ‡µ JPN</span><span class="point-text">äºæ´²æ£’çƒæœ€é«˜æ®¿å ‚çš„ã€Œä¸–ä»‡å°æ±ºã€ï¼æ±äº¬å·¨è›‹å°‡åŒ–èº«ç‚ºæ²¸é¨°çš„å£“åŠ›é‹ã€‚</span></td><td>19:00</td></tr>
                            <tr class="tpe-highlight"><td>3/8</td><td><span class="team-name" style="color:var(--m-blue);">ğŸ‡°ğŸ‡· KOR vs ğŸ‡¹ğŸ‡¼ TPE</span><span class="point-text">å®¿å‘½å¾©ä»‡æˆ°ï¼é€™å ´æ¯”è³½æ¥µé«˜æ©Ÿç‡æ±ºå®šèª°èƒ½ä»¥åˆ†çµ„ç¬¬äºŒæ™‰ç´šã€‚è«‹æº–å‚™å¥½æœ€å¼·çš„æ‡‰æ´ç«åŠ›ã€‚</span></td><td>12:00</td></tr>
                            <tr><td>3/8</td><td><span class="team-name">ğŸ‡¦ğŸ‡º AUS vs ğŸ‡¯ğŸ‡µ JPN</span><span class="point-text">æ¾³æ´²è‹¥èƒ½å’¬ä½æ¯”åˆ†ï¼Œå°‡æœ‰æ©Ÿæœƒè£½é€ æœ¬å±†è³½äº‹æœ€å¤§å†·é–€ã€‚</span></td><td>19:00</td></tr>
                            <tr><td>3/9</td><td><span class="team-name">ğŸ‡¦ğŸ‡º AUS vs ğŸ‡°ğŸ‡· KOR</span><span class="point-text">å°çµ„è³½å°¾è²çš„é—œéµæˆ°å½¹ã€‚è‹¥æˆ°æ³è† è‘—ï¼Œæ­¤æˆ°å¯èƒ½æˆç‚ºã€Œé©Ÿæ­»è³½ã€ã€‚</span></td><td>19:00</td></tr>
                            <tr><td>3/10</td><td><span class="team-name">ğŸ‡¯ğŸ‡µ JPN vs ğŸ‡¨ğŸ‡¿ CZE</span><span class="point-text">å……æ»¿æ•¬æ„çš„å‹èª¼ä¹‹æˆ°ï¼Œé è¨ˆå°‡æ˜¯ä¸€å ´æ°£æ°›æº«é¦¨çš„æ¯”è³½ã€‚</span></td><td>19:00</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchMainView('itinerary', this)">
            <span class="nav-icon">ğŸ“…</span>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="nav-item" onclick="switchMainView('wbc', this)">
            <span class="nav-icon">âš¾</span>
            <span>æˆ°æƒ…</span>
        </div>
        <div class="nav-item" onclick="switchMainView('tools', this)">
            <span class="nav-icon">ğŸ§°</span>
            <span>å·¥å…·</span>
        </div>
    </div>

    <script>
        // --- Cloud Integration ---
        const API_KEY = "$2a$10$ZlTu6LnI34CcBg2pLHujRucoqxSgwivLsQcsdpnLOwhz/q8QWBWQO";
        const BIN_ID = "697a0edbd0ea881f408d4ed5";
        let debounceTimer;
        let countdownInterval;
        let timeLeft = 10;

        function updateSyncStatus(status, text) {
            const dot = document.getElementById('sync-dot');
            const txt = document.getElementById('sync-text');
            dot.className = 'sync-dot ' + status;
            txt.innerText = text;
        }

        async function syncFromCloud() {
            updateSyncStatus('working', 'åŒæ­¥ä¸­...');
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    headers: { 'X-Master-Key': API_KEY }
                });
                if(res.ok) {
                    const json = await res.json();
                    const data = json.record;
                    if(data.shoppingData) {
                        shoppingData = data.shoppingData;
                        renderShoppingList();
                    }
                    if(data.packing) {
                        packingData = data.packing;
                        renderPackingList();
                    }
                    if(data.expenses) {
                        expenseData = data.expenses;
                        renderExpenseList();
                    }
                    updateSyncStatus('active', 'å·²åŒæ­¥');
                } else {
                    updateSyncStatus('error', 'åŒæ­¥å¤±æ•—');
                }
            } catch(e) {
                updateSyncStatus('error', 'ç¶²è·¯éŒ¯èª¤');
            }
        }

        function triggerSyncToCloud() {
            clearTimeout(debounceTimer);
            clearInterval(countdownInterval);
            timeLeft = 10;
            updateSyncStatus('working', `ç­‰å¾…ä¸Šå‚³ (${timeLeft}s)...`);
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                if(timeLeft > 0) {
                    updateSyncStatus('working', `ç­‰å¾…ä¸Šå‚³ (${timeLeft}s)...`);
                } else {
                    clearInterval(countdownInterval);
                    updateSyncStatus('working', 'ä¸Šå‚³ä¸­...');
                }
            }, 1000);

            debounceTimer = setTimeout(async () => {
                const data = {
                    shoppingData: shoppingData,
                    packing: packingData,
                    expenses: expenseData
                };
                try {
                    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                        method: 'PUT',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Master-Key': API_KEY 
                        },
                        body: JSON.stringify(data)
                    });
                    if(res.ok) updateSyncStatus('active', 'å·²åŒæ­¥');
                    else updateSyncStatus('error', 'ä¸Šå‚³å¤±æ•—');
                } catch(e) { updateSyncStatus('error', 'ä¸Šå‚³éŒ¯èª¤'); }
            }, 10000);
        }

        // --- Standard Logic ---
        let currentRate = 0.215; 

        function switchMainView(viewName, btn) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            
            document.querySelectorAll('.bottom-nav .nav-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            document.querySelectorAll('.sub-nav-wrapper').forEach(el => el.classList.remove('active'));
            if (viewName === 'itinerary') {
                document.getElementById('sub-nav-itinerary').classList.add('active');
                setTimeout(() => updateSliderHeight(document.querySelector('#sub-nav-itinerary .sub-tab-btn.active').getAttribute('data-tab')), 10);
            } else if (viewName === 'tools') {
                document.getElementById('sub-nav-tools').classList.add('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showSubTab(tabId, btn) {
            const parentViewId = btn.closest('.sub-nav-wrapper').id;
            
            if (parentViewId === 'sub-nav-itinerary') {
                const allBtns = document.querySelectorAll('#sub-nav-itinerary .sub-tab-btn');
                allBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const index = parseInt(tabId.replace('d', '')) - 1;
                document.getElementById('itinerary-track').style.transform = `translateX(-${index * 100}%)`;
                updateSliderHeight(tabId);
            } else {
                const parentView = document.getElementById('view-tools');
                btn.parentElement.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                parentView.querySelectorAll('.day-content').forEach(c => {
                    c.style.display = 'none';
                    c.classList.remove('active', 'anim-up');
                });
                const target = document.getElementById(tabId);
                target.style.display = 'block';
                setTimeout(() => target.classList.add('active', 'anim-up'), 10);
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateSliderHeight(tabId) {
            const activeSlide = document.getElementById(tabId);
            const track = document.getElementById('itinerary-track');
            if(activeSlide && track) {
                setTimeout(() => { track.style.height = activeSlide.offsetHeight + 'px'; }, 10);
            }
        }

        let touchStartX = 0;
        const itineraryView = document.getElementById('view-itinerary');
        const days = ['d1', 'd2', 'd3', 'd4', 'd5'];
        itineraryView.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
        itineraryView.addEventListener('touchend', e => { handleSwipe(touchStartX, e.changedTouches[0].screenX); }, {passive: true});

        function handleSwipe(start, end) {
            const diff = start - end;
            const currentTab = document.querySelector('#sub-nav-itinerary .sub-tab-btn.active');
            if (!currentTab) return;
            const currentIndex = days.indexOf(currentTab.getAttribute('data-tab'));

            if (Math.abs(diff) > 60) {
                if (diff > 0 && currentIndex < days.length - 1) {
                    showSubTab(days[currentIndex + 1], document.querySelector(`[data-tab="${days[currentIndex + 1]}"]`));
                } else if (diff < 0 && currentIndex > 0) {
                    showSubTab(days[currentIndex - 1], document.querySelector(`[data-tab="${days[currentIndex - 1]}"]`));
                }
            }
        }

        // --- Categorized Shopping List Logic ---
        let shoppingData = JSON.parse(localStorage.getItem('wbc_shopping_v2')) || [
            { 
                id: 1, 
                name: 'è—¥å¦ ğŸ’Š', 
                items: [
                    { id: 11, text: 'EVE æ­¢ç—›è—¥', checked: false },
                    { id: 12, text: 'åˆåˆ©ä»–å‘½', checked: false }
                ] 
            },
            {
                id: 2,
                name: 'Uniqlo ğŸ‘•',
                items: [
                    { id: 21, text: 'ç™¼ç†±è¡£', checked: false }
                ]
            }
        ];

        function renderShoppingList() {
            const container = document.getElementById('shopping-container');
            container.innerHTML = '';
            
            shoppingData.forEach((cat, catIndex) => {
                const catDiv = document.createElement('div');
                catDiv.className = 'shop-category';
                const header = document.createElement('div');
                header.className = 'shop-cat-header';
                header.innerHTML = `
                    <input class="shop-cat-title" value="${cat.name}" oninput="updateCatName(${catIndex}, this.value)">
                    <div class="shop-cat-actions">
                        <button class="shop-cat-del" onclick="deleteCategory(${catIndex})">Ã—</button>
                    </div>
                `;
                catDiv.appendChild(header);

                const tableContainer = document.createElement('div');
                tableContainer.className = 'shop-items-container';
                const table = document.createElement('table');
                table.className = 'packing-table';
                
                cat.items.forEach((item, itemIndex) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="width:30px; text-align:center;">
                            <input type="checkbox" class="packing-check" ${item.checked ? 'checked' : ''} onchange="toggleShopCheck(${catIndex}, ${itemIndex})">
                        </td>
                        <td>
                            <input type="text" class="packing-input ${item.checked ? 'checked' : ''}" value="${item.text}" oninput="updateShopItem(${catIndex}, ${itemIndex}, this.value)">
                        </td>
                        <td style="width:30px; text-align:center;">
                            <button class="packing-del" onclick="deleteShopItem(${catIndex}, ${itemIndex})">Ã—</button>
                        </td>
                    `;
                    table.appendChild(tr);
                });
                
                const addRow = document.createElement('div');
                addRow.style.padding = "5px 0";
                addRow.style.textAlign = "center";
                addRow.innerHTML = `<button class="shop-item-btn" onclick="addShopItemToCategory(${catIndex})">+ æ–°å¢é …ç›®</button>`;
                
                tableContainer.appendChild(table);
                tableContainer.appendChild(addRow);
                catDiv.appendChild(tableContainer);
                container.appendChild(catDiv);
            });
            localStorage.setItem('wbc_shopping_v2', JSON.stringify(shoppingData));
        }

        function addCategory() { shoppingData.push({ id: Date.now(), name: 'æ–°é¡åˆ¥', items: [] }); renderShoppingList(); triggerSyncToCloud(); }
        function deleteCategory(index) { if(confirm('ç¢ºå®šåˆªé™¤æ­¤é¡åˆ¥ï¼Ÿ')) { shoppingData.splice(index, 1); renderShoppingList(); triggerSyncToCloud(); } }
        function updateCatName(index, val) { shoppingData[index].name = val; localStorage.setItem('wbc_shopping_v2', JSON.stringify(shoppingData)); triggerSyncToCloud(); }
        function addShopItemToCategory(catIndex) { shoppingData[catIndex].items.push({ id: Date.now(), text: '', checked: false }); renderShoppingList(); triggerSyncToCloud(); }
        function deleteShopItem(catIndex, itemIndex) { shoppingData[catIndex].items.splice(itemIndex, 1); renderShoppingList(); triggerSyncToCloud(); }
        function toggleShopCheck(catIndex, itemIndex) { shoppingData[catIndex].items[itemIndex].checked = !shoppingData[catIndex].items[itemIndex].checked; renderShoppingList(); triggerSyncToCloud(); }
        function updateShopItem(catIndex, itemIndex, val) { shoppingData[catIndex].items[itemIndex].text = val; localStorage.setItem('wbc_shopping_v2', JSON.stringify(shoppingData)); triggerSyncToCloud(); }

        // --- EXPENSE TRACKER LOGIC ---
        const defaultExpenses = [
            { id: 1, dateTitle: 'Day 1 (3/5)', items: [] },
            { id: 2, dateTitle: 'Day 2 (3/6)', items: [] },
            { id: 3, dateTitle: 'Day 3 (3/7)', items: [] },
            { id: 4, dateTitle: 'Day 4 (3/8)', items: [] },
            { id: 5, dateTitle: 'Day 5 (3/9)', items: [] }
        ];

        let expenseData = JSON.parse(localStorage.getItem('wbc_expense_v1')) || defaultExpenses;

        function renderExpenseList() {
            const container = document.getElementById('expense-container');
            const grandTotalEl = document.getElementById('expense-grand-total');
            container.innerHTML = '';
            
            let grandJPY = 0;
            let grandTWD = 0;

            expenseData.forEach((dateBlock, dIndex) => {
                let subJPY = 0;
                let subTWD = 0;
                dateBlock.items.forEach(item => {
                    let p = parseFloat(item.price);
                    if(isNaN(p)) p = 0;
                    if(item.curr === 'JPY') subJPY += p; else subTWD += p;
                });
                grandJPY += subJPY;
                grandTWD += subTWD;

                const block = document.createElement('div');
                block.className = 'expense-date-block';
                
                block.innerHTML = `
                    <div class="expense-header">
                        <input class="expense-date-input" value="${dateBlock.dateTitle}" oninput="updateExpTitle(${dIndex}, this.value)">
                        <span class="expense-summary" id="exp-total-${dIndex}">Â¥ ${subJPY} | $ ${subTWD}</span>
                    </div>
                    <div class="expense-body" id="exp-body-${dIndex}">
                        </div>
                    <div class="expense-add-row">
                        <button class="expense-item-btn" onclick="addExpItem(${dIndex})">+ æ–°å¢æ¶ˆè²»</button>
                    </div>
                `;

                const body = block.querySelector(`#exp-body-${dIndex}`);
                dateBlock.items.forEach((item, iIndex) => {
                    const row = document.createElement('div');
                    row.className = 'expense-row';
                    // Use input type="number" but hide arrows via CSS class .expense-price-input
                    row.innerHTML = `
                        <input class="expense-item-input" placeholder="é …ç›®" value="${item.name}" oninput="updateExpItem(${dIndex}, ${iIndex}, 'name', this.value)">
                        <input type="number" class="expense-price-input" placeholder="0" value="${item.price}" oninput="updateExpItem(${dIndex}, ${iIndex}, 'price', this.value)">
                        <select class="expense-currency" onchange="updateExpItem(${dIndex}, ${iIndex}, 'curr', this.value)">
                            <option value="JPY" ${item.curr === 'JPY' ? 'selected' : ''}>JPY</option>
                            <option value="TWD" ${item.curr === 'TWD' ? 'selected' : ''}>TWD</option>
                        </select>
                        <button class="shop-cat-del" style="font-size:18px;" onclick="deleteExpItem(${dIndex}, ${iIndex})">Ã—</button>
                    `;
                    body.appendChild(row);
                });
                container.appendChild(block);
            });
            
            // Update Grand Total in Header
            if(grandTotalEl) grandTotalEl.innerText = `Total: Â¥ ${grandJPY} | $ ${grandTWD}`;
            localStorage.setItem('wbc_expense_v1', JSON.stringify(expenseData));
        }

        function recalculateTotals() {
            let grandJPY = 0;
            let grandTWD = 0;

            expenseData.forEach((block, dIdx) => {
                let subJPY = 0;
                let subTWD = 0;
                block.items.forEach(item => {
                    let p = parseFloat(item.price);
                    if(isNaN(p)) p = 0;
                    if(item.curr === 'JPY') subJPY += p;
                    else subTWD += p;
                });

                // Update Subtotal DOM
                const subEl = document.getElementById(`exp-total-${dIdx}`);
                if(subEl) subEl.innerText = `Â¥ ${subJPY} | $ ${subTWD}`;

                grandJPY += subJPY;
                grandTWD += subTWD;
            });

            // Update Grand Total DOM
            const grandEl = document.getElementById('expense-grand-total');
            if(grandEl) grandEl.innerText = `Total: Â¥ ${grandJPY} | $ ${grandTWD}`;
        }

        function updateExpTitle(idx, val) { expenseData[idx].dateTitle = val; localStorage.setItem('wbc_expense_v1', JSON.stringify(expenseData)); triggerSyncToCloud(); }
        function addExpItem(idx) { expenseData[idx].items.push({ name: '', price: '', curr: 'JPY' }); renderExpenseList(); triggerSyncToCloud(); }
        function deleteExpItem(dIdx, iIdx) { expenseData[dIdx].items.splice(iIdx, 1); renderExpenseList(); triggerSyncToCloud(); }
        
        function updateExpItem(dIdx, iIdx, field, val) { 
            expenseData[dIdx].items[iIdx][field] = val; 
            
            // If price or currency changed, update totals UI immediately (Smart Calc)
            if(field === 'price' || field === 'curr') {
                recalculateTotals();
            }
            
            localStorage.setItem('wbc_expense_v1', JSON.stringify(expenseData)); 
            triggerSyncToCloud(); 
        }


        // --- Packing List Logic ---
        let packingData = JSON.parse(localStorage.getItem('wbc_packing_v1')) || [
            { id: 1, text: 'è­·ç…§', qty: 1, checked: false }, 
            { id: 2, text: 'æ—¥å¹£', qty: 1, checked: false }, 
            { id: 3, text: 'ç¶²å¡', qty: 1, checked: false }, 
            { id: 4, text: 'çƒè¡£', qty: 1, checked: false }
        ];
        function renderPackingList() {
            const table = document.getElementById('packing-table-body'); 
            table.innerHTML = '';
            packingData.forEach((item, index) => {
                const tr = document.createElement('tr');
                const qty = item.qty || 1;
                tr.innerHTML = `
                    <td style="width:30px; text-align:center;">
                        <input type="checkbox" class="packing-check" ${item.checked ? 'checked' : ''} onchange="togglePackingCheck(${index})">
                    </td>
                    <td>
                        <input type="text" class="packing-input ${item.checked ? 'checked' : ''}" value="${item.text}" oninput="updatePackingText(${index}, this.value)">
                    </td>
                    <td style="width:40px; text-align:center;">
                        <input type="number" class="qty-input" value="${qty}" oninput="updatePackingQty(${index}, this.value)">
                    </td>
                    <td style="width:30px; text-align:center;">
                        <button class="packing-del" onclick="deletePackingItem(${index})">Ã—</button>
                    </td>
                `;
                table.appendChild(tr);
            });
            localStorage.setItem('wbc_packing_v1', JSON.stringify(packingData));
        }
        function addPackingItem() { packingData.push({ id: Date.now(), text: '', qty: 1, checked: false }); renderPackingList(); triggerSyncToCloud(); }
        function deletePackingItem(index) { packingData.splice(index, 1); renderPackingList(); triggerSyncToCloud(); }
        function togglePackingCheck(index) { packingData[index].checked = !packingData[index].checked; renderPackingList(); triggerSyncToCloud(); }
        function updatePackingText(index, value) { packingData[index].text = value; localStorage.setItem('wbc_packing_v1', JSON.stringify(packingData)); triggerSyncToCloud(); }
        function updatePackingQty(index, value) { packingData[index].qty = value; localStorage.setItem('wbc_packing_v1', JSON.stringify(packingData)); triggerSyncToCloud(); }

        // Calculator
        async function fetchTaiwanRate() {
            if (!navigator.onLine) { document.getElementById('rate-source').innerText = `âš ï¸ è³‡æ–™ä¾†æº: é è¨­å€¼ (ç›®å‰é›¢ç·š)`; return; }
            try {
                const res = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://tw.rter.info/capi.php'));
                const data = await res.json();
                const rates = JSON.parse(data.contents); 
                const usdtwd = rates.USDTWD.Exrate; const usdjpy = rates.USDJPY.Exrate; const jpyToTwd = usdtwd / usdjpy;
                if (!isNaN(jpyToTwd)) {
                    currentRate = jpyToTwd;
                    document.getElementById('rate-val').innerText = currentRate.toFixed(4);
                    const now = new Date();
                    document.getElementById('rate-source').innerText = `è³‡æ–™ä¾†æº: å°ç£å¸‚å ´åŒ¯ç‡ (Rter.info) | æ›´æ–°: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                }
            } catch (e) { console.log("Fetch failed"); }
        }
        function calc(source) {
            const jpy = parseFloat(document.getElementById('input-jpy').value);
            const twd = parseFloat(document.getElementById('input-twd').value);
            if (source === 'jpy' && !isNaN(jpy)) document.getElementById('input-twd').value = (jpy * currentRate).toFixed(0);
            else if (source === 'twd' && !isNaN(twd)) document.getElementById('input-jpy').value = (twd / currentRate).toFixed(0);
        }
        function resetCalc() { document.getElementById('input-jpy').value = ''; document.getElementById('input-twd').value = ''; }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            fetchTaiwanRate(); 
            document.getElementById('input-jpy').addEventListener('input', () => calc('jpy'));
            document.getElementById('input-twd').addEventListener('input', () => calc('twd'));
            
            renderPackingList();
            renderShoppingList();
            renderExpenseList(); // Init Expenses
            syncFromCloud(); // Auto-load
            
            setTimeout(() => updateSliderHeight('d1'), 100);
        });
    </script>
</body>
</html>